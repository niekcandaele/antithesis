{{- if .Values.keycloak.mappers.organizations.enabled }}
apiVersion: client.keycloak.crossplane.io/v1alpha1
kind: ProtocolMapper
metadata:
  name: {{ .Values.keycloak.oidcClient.id }}-organizations-mapper
spec:
  providerConfigRef:
    name: {{ .Values.keycloak.providerConfigRef }}
  forProvider:
    realmId: {{ .Values.keycloak.realm.name }}
    clientIdRef:
      name: {{ .Values.keycloak.oidcClient.id }}-client
    name: "organizations"
    protocol: "openid-connect"

    # Protocol mapper type - maps user attribute to claim
    # Note: For Keycloak Organizations, you may need a custom mapper
    # or use group membership mapper with organization groups
    protocolMapper: "oidc-group-membership-mapper"

    config:
      # Claim name in tokens
      "claim.name": {{ .Values.keycloak.mappers.organizations.claimName | quote }}

      # Include in different token types
      "userinfo.token.claim": "true"
      "id.token.claim": "true"
      "access.token.claim": "true"

      # Full group path (organizations may appear as groups)
      "full.path": "false"
{{- end }}
